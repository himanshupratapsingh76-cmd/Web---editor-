<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Mobile Pro Editor — HTML • CSS • JS</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/neo.min.css">
  <style>
    :root{
      --bg:#f3f4f6; --panel:#ffffff; --accent:#0ea5a4; --muted:#475569;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial;background:var(--bg);color:#0f172a;-webkit-tap-highlight-color: transparent;}
    .app{display:flex;flex-direction:column;height:100vh}
    header{display:flex;align-items:center;gap:8px;padding:10px;background:linear-gradient(90deg,#0ea5a4,#06b6d4);color:white}
    header h1{font-size:16px;margin:0;flex:1}
    .controls{display:flex;gap:6px;align-items:center}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.2);color:white;padding:6px 8px;border-radius:8px;font-size:14px}
    main{display:flex;flex-direction:column;flex:1;padding:8px;gap:8px}
    .toolbar{display:flex;gap:6px;align-items:center;overflow:auto;padding-bottom:6px}
    .tab-btn{flex:1;background:var(--panel);border-radius:8px;padding:8px;text-align:center;font-weight:600;color:var(--muted);box-shadow:0 2px 6px rgba(2,6,23,0.06)}
    .tab-btn.active{background:linear-gradient(180deg,#e6fffa,#ccfbf1);color:#064e3b}
    .editor-wrap{flex:1;display:flex;flex-direction:column;background:var(--panel);border-radius:10px;overflow:hidden}
    .cm-wrapper{flex:1;min-height:160px}
    .CodeMirror{height:100%}
    .divider{height:8px;background:#eef2ff;display:flex;align-items:center;justify-content:center;cursor:ns-resize;touch-action:none}
    .divider .dot{width:36px;height:4px;background:#c7d2fe;border-radius:4px}
    iframe#preview{width:100%;height:100%;border:0;background:white}
    footer{display:flex;gap:8px;padding:8px;align-items:center}
    .big-btn{flex:1;padding:10px;border-radius:8px;background:var(--accent);color:white;text-align:center;font-weight:700}
    input.file{display:none}
    .small{font-size:12px;color:var(--muted)}
    @media (min-width:700px){
      header h1{font-size:18px}
      .tab-btn{max-width:120px}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Mobile Pro Editor</h1>
      <div class="controls">
        <button id="newFile" class="btn">New</button>
        <label for="openFile" class="btn" style="cursor:pointer">Open</label>
        <input id="openFile" class="file" type="file" accept=".html,.htm,text/html,text/plain"/>
      </div>
    </header>

    <main>
      <div class="toolbar" role="tablist">
        <div id="tabHtml" class="tab-btn active" data-tab="html">HTML</div>
        <div id="tabCss" class="tab-btn" data-tab="css">CSS</div>
        <div id="tabJs" class="tab-btn" data-tab="js">JS</div>
      </div>

      <div class="editor-wrap" id="editorArea">
        <div id="editors" class="editors" style="flex:1;display:flex;flex-direction:column">
          <div id="htmlEditor" class="cm-wrapper"></div>
          <div id="cssEditor" class="cm-wrapper" style="display:none"></div>
          <div id="jsEditor" class="cm-wrapper" style="display:none"></div>
        </div>

        <div class="divider" id="divider"><div class="dot"></div></div>

        <div style="height:42vh;min-height:120px;">
          <iframe id="preview" title="Live Preview"></iframe>
        </div>
      </div>
    </main>

    <footer>
      <button id="save" class="big-btn">Save</button>
      <button id="download" class="big-btn" style="background:#2563eb">Download</button>
      <button id="liveToggle" class="big-btn" style="background:#f97316">Live: ON</button>
    </footer>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closetag.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closebrackets.min.js"></script>
  <script>
    // Mobile-first editor: touch-friendly, large buttons, simple features
    let live = true;
    let currentFileName = 'mobile-untitled.html';

    const tabHtml = document.getElementById('tabHtml');
    const tabCss = document.getElementById('tabCss');
    const tabJs = document.getElementById('tabJs');
    const tabs = [tabHtml, tabCss, tabJs];

    function makeEditor(target, mode){
      const ta = document.createElement('textarea');
      target.appendChild(ta);
      const ed = CodeMirror.fromTextArea(ta, {
        mode: mode,
        lineNumbers: true,
        lineWrapping: true,
        theme: 'neo',
        indentUnit: 2,
        tabSize: 2,
        indentWithTabs: false,
        autoCloseTags: true,
        autoCloseBrackets: true,
        matchBrackets: true,
      });
      ed.setSize('100%','100%');
      // increase font for mobile readability
      ed.getWrapperElement().style.fontSize = '15px';
      return ed;
    }

    const htmlEditor = makeEditor(document.getElementById('htmlEditor'), 'htmlmixed');
    const cssEditor = makeEditor(document.getElementById('cssEditor'), 'css');
    const jsEditor = makeEditor(document.getElementById('jsEditor'), 'javascript');

    // default content
    htmlEditor.setValue(`<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mobile Preview</title>
  </head>
  <body>
    <h1>Namaste — Mobile Editor</h1>
    <p>Yah editor mobile browsers ke liye optimized hai.</p>
  </body>
</html>`);
    cssEditor.setValue(`body{font-family:system-ui, Arial; padding:16px; background:#fff; color:#0b1220}`);
    jsEditor.setValue(`console.log('Mobile editor loaded');`);

    // tab switching (touch friendly)
    tabs.forEach(t=> t.addEventListener('click', ()=>{
      tabs.forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      const which = t.dataset.tab;
      document.getElementById('htmlEditor').style.display = which==='html' ? 'block' : 'none';
      document.getElementById('cssEditor').style.display = which==='css' ? 'block' : 'none';
      document.getElementById('jsEditor').style.display = which==='js' ? 'block' : 'none';
      htmlEditor.refresh(); cssEditor.refresh(); jsEditor.refresh();
    }));

    // build preview
    const preview = document.getElementById('preview');
    function buildDoc(){
      let doc = htmlEditor.getValue();
      const css = cssEditor.getValue();
      const js = jsEditor.getValue();
      if(doc.includes('</head>')){
        doc = doc.replace('</head>', `<style>\n${css}\n</style>\n</head>`);
      } else {
        doc = `<head><style>\n${css}\n</style></head>\n` + doc;
      }
      if(doc.includes('</body>')){
        doc = doc.replace('</body>', `<script>\n${js}\n</script>\n</body>`);
      } else {
        doc = doc + `\n<script>\n${js}\n</script>\n`;
      }
      return doc;
    }
    function renderPreview(){
      if(!live) return;
      const doc = buildDoc();
      const iframeDoc = preview.contentDocument || preview.contentWindow.document;
      iframeDoc.open();
      iframeDoc.write(doc);
      iframeDoc.close();
    }

    // live debounce
    let timer;
    [htmlEditor, cssEditor, jsEditor].forEach(ed=> ed.on('change', ()=>{
      clearTimeout(timer);
      timer = setTimeout(()=>{ renderPreview(); }, 600);
    }));

    // Live toggle
    const liveToggle = document.getElementById('liveToggle');
    liveToggle.addEventListener('click', ()=>{
      live = !live;
      liveToggle.textContent = live ? 'Live: ON' : 'Live: OFF';
      liveToggle.style.background = live ? '#f97316' : '#94a3b8';
      renderPreview();
    });

    // Save / Download (browser-only: triggers download)
    function downloadContent(name, content){
      const blob = new Blob([content], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = name;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }
    document.getElementById('save').addEventListener('click', ()=>{
      const full = buildDoc();
      downloadContent(currentFileName, full);
      alert('File saved to Downloads: ' + currentFileName);
    });
    document.getElementById('download').addEventListener('click', ()=>{
      const full = buildDoc();
      downloadContent(currentFileName, full);
    });

    // New file
    document.getElementById('newFile').addEventListener('click', ()=>{
      if(!confirm('Discard changes and create new file?')) return;
      htmlEditor.setValue(`<!doctype html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>Untitled</title>\n  </head>\n  <body>\n    <h1>New File</h1>\n  </body>\n</html>`);
      cssEditor.setValue('');
      jsEditor.setValue('');
      renderPreview();
    });

    // Open file: extract <style> and <script>
    const openFile = document.getElementById('openFile');
    openFile.addEventListener('change', (ev)=>{
      const f = ev.target.files[0];
      if(!f) return;
      currentFileName = f.name;
      const reader = new FileReader();
      reader.onload = ()=>{
        let text = reader.result;
        let css = '', js = '';
        text = text.replace(/<style[^>]*>([\s\S]*?)<\/style>/gi, function(m,p1){ css+=p1 + '\\n'; return ''; });
        text = text.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi, function(m,p1){ js+=p1 + '\\n'; return ''; });
        text = text.trim();
        if(!text) text = '<!doctype html>\\n<html>\\n  <head>\\n  </head>\\n  <body>\\n  </body>\\n</html>';
        htmlEditor.setValue(text);
        cssEditor.setValue(css);
        jsEditor.setValue(js);
        renderPreview();
      };
      reader.readAsText(f);
      openFile.value = '';
    });

    // Divider: touch and mouse for resizing editors vs preview
    const divider = document.getElementById('divider');
    const editorsWrap = document.getElementById('editors');
    let startY=0, startH=0;
    function startDrag(clientY){
      startY = clientY;
      startH = editorsWrap.getBoundingClientRect().height;
    }
    function doDrag(clientY){
      const dy = clientY - startY;
      const newH = Math.max(100, startH + dy);
      editorsWrap.style.flex = 'none';
      editorsWrap.style.height = newH + 'px';
      htmlEditor.refresh(); cssEditor.refresh(); jsEditor.refresh();
    }
    // mouse events
    divider.addEventListener('mousedown', (e)=>{ startDrag(e.clientY); document.addEventListener('mousemove', onMouseMove); document.addEventListener('mouseup', onMouseUp); });
    function onMouseMove(e){ doDrag(e.clientY); }
    function onMouseUp(){ document.removeEventListener('mousemove', onMouseMove); document.removeEventListener('mouseup', onMouseUp); }
    // touch events
    divider.addEventListener('touchstart', (e)=>{ const t = e.touches[0]; startDrag(t.clientY); }, {passive:true});
    divider.addEventListener('touchmove', (e)=>{ const t = e.touches[0]; doDrag(t.clientY); }, {passive:true});

    // Prevent mobile zoom on double-tap (simple)
    let lastTap = 0;
    document.addEventListener('touchend', (e)=>{
      const now = Date.now();
      if(now - lastTap < 300){ e.preventDefault(); }
      lastTap = now;
    }, {passive:false});

    // Initial render
    renderPreview();
    // expose for debugging
    window.mobileEditor = { htmlEditor, cssEditor, jsEditor, renderPreview };
  </script>
</body>
</html>
